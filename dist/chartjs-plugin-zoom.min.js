/*!
 * @license
 * chartjs-plugin-zoom
 * http://chartjs.org/
 * Version: 0.7.7
 *
 * Copyright 2020 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-plugin-zoom/blob/master/LICENSE.md
 */
!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],e):(o=o||self).ChartZoom=e(o.Chart,o.Hammer)}(this,(function(o,e){"use strict";o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n=o.helpers,t=o.Zoom=o.Zoom||{},a=t.zoomFunctions=t.zoomFunctions||{},i=t.panFunctions=t.panFunctions||{};function r(o,e){var t={};void 0!==o.options.pan&&(t.pan=o.options.pan),void 0!==o.options.zoom&&(t.zoom=o.options.zoom);var a=o.$zoom;e=a._options=n.merge({},[e,t]);var i=a._node,r=e.zoom&&e.zoom.enabled,m=e.zoom.drag;r&&!m?i.addEventListener("wheel",a._wheelHandler):i.removeEventListener("wheel",a._wheelHandler),r&&m?(i.addEventListener("mousedown",a._mouseDownHandler),i.ownerDocument.addEventListener("mouseup",a._mouseUpHandler)):(i.removeEventListener("mousedown",a._mouseDownHandler),i.removeEventListener("mousemove",a._mouseMoveHandler),i.ownerDocument.removeEventListener("mouseup",a._mouseUpHandler))}function m(o){var e=o.$zoom._originalOptions;n.each(o.scales,(function(o){e[o.id]||(e[o.id]=n.clone(o.options))})),n.each(e,(function(n,t){o.scales[t]||delete e[t]}))}function l(o,e,n){return void 0===o||("string"==typeof o?-1!==o.indexOf(e):"function"==typeof o&&-1!==o({chart:n}).indexOf(e))}function s(o,e){if(o.scaleAxes&&o.rangeMax&&!n.isNullOrUndef(o.rangeMax[o.scaleAxes])){var t=o.rangeMax[o.scaleAxes];e>t&&(e=t)}return e}function c(o,e){if(o.scaleAxes&&o.rangeMin&&!n.isNullOrUndef(o.rangeMin[o.scaleAxes])){var t=o.rangeMin[o.scaleAxes];e<t&&(e=t)}return e}function u(o,e,n,t){var a=o.max-o.min,i=a*(e-1),r=o.isHorizontal()?n.x:n.y,m=(o.getValueForPixel(r)-o.min)/a,l=i*m,u=i*(1-m);o.options.min=c(t,o.min+l),o.options.max=s(t,o.max-u)}function d(o,e,n,t){var i=a[o.type];i&&i(o,e,n,t)}function p(o,e,t,a,i,r){var s=o.chartArea;a||(a={x:(s.left+s.right)/2,y:(s.top+s.bottom)/2});var c=o.$zoom._options.zoom;if(c.enabled){m(o);var u,p="function"==typeof c.mode?c.mode({chart:o}):c.mode;u="xy"===p&&void 0!==i?i:"xy",n.each(o.scales,(function(n){n.isHorizontal()&&l(p,"x",o)&&l(u,"x",o)?(c.scaleAxes="x",d(n,e,a,c)):!n.isHorizontal()&&l(p,"y",o)&&l(u,"y",o)&&(c.scaleAxes="y",d(n,t,a,c))})),r?(o.options.animation.zoom||(o.options.animation.zoom={duration:r,easing:"easeOutQuad"}),o.update("zoom")):o.update("none"),"function"==typeof c.onZoom&&c.onZoom({chart:o})}}function v(o,e,t){var a,i=o.options,r=o.min,m=o.max,l=o.getValueForPixel(o.getPixelForValue(r)-e),s=o.getValueForPixel(o.getPixelForValue(m)-e),c=l,u=s;t.scaleAxes&&t.rangeMin&&!n.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(c=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!n.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(u=t.rangeMax[t.scaleAxes]),l>=c&&s<=u?(i.min=l,i.max=s):l<c?(a=r-c,i.min=c,i.max=m-a):s>u&&(a=u-m,i.max=u,i.min=r+a)}function f(o,e,n){var t=i[o.type];t&&t(o,e,n)}t.zoomFunctions.category=function(o,e,n,a){var i=o.chart.data.labels,r=o.min,m=i.length-1,l=o.max,u=a.sensitivity,d=o.isHorizontal()?o.left+o.width/2:o.top+o.height/2,p=o.isHorizontal()?n.x:n.y;t.zoomCumulativeDelta=e>1?t.zoomCumulativeDelta+1:t.zoomCumulativeDelta-1,Math.abs(t.zoomCumulativeDelta)>u&&(t.zoomCumulativeDelta<0?(p>=d?r<=0?l=Math.min(m,l+1):r=Math.max(0,r-1):p<d&&(l>=m?r=Math.max(0,r-1):l=Math.min(m,l+1)),t.zoomCumulativeDelta=0):t.zoomCumulativeDelta>0&&(p>=d?r=r<l?r=Math.min(l,r+1):r:p<d&&(l=l>r?l=Math.max(r,l-1):l),t.zoomCumulativeDelta=0),o.options.min=c(a,i[r]),o.options.max=s(a,i[l]))},t.zoomFunctions.time=u,t.zoomFunctions.linear=u,t.zoomFunctions.logarithmic=u,t.panFunctions.category=function(o,e,n){var a,i=o.chart.data.labels,r=i.length-1,m=Math.max(o.ticks.length,1),l=n.speed,u=o.min,d=Math.round(o.width/(m*l));t.panCumulativeDelta+=e,u=t.panCumulativeDelta>d?Math.max(0,u-1):t.panCumulativeDelta<-d?Math.min(r-m+1,u+1):u,t.panCumulativeDelta=u!==o.min?0:t.panCumulativeDelta,a=Math.min(r,u+m-1),o.options.min=c(n,i[u]),o.options.max=s(n,i[a])},t.panFunctions.time=v,t.panFunctions.linear=v,t.panFunctions.logarithmic=v,t.panCumulativeDelta=0,t.zoomCumulativeDelta=0;var h={id:"zoom",defaults:{pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1,stickSide:void 0}},start:function(o,a,i){o.$zoom={_originalOptions:{}};var s=o.$zoom._node=o.ctx.canvas;r(o,i);var c=o.$zoom._options,u=c.pan&&c.pan.threshold;o.$zoom._mouseDownHandler=function(e){s.addEventListener("mousemove",o.$zoom._mouseMoveHandler),o.$zoom._dragZoomStart=e},o.$zoom._mouseMoveHandler=function(e){o.$zoom._dragZoomStart&&(o.$zoom._dragZoomEnd=e,o.update("none"))},o.$zoom._mouseUpHandler=function(e){if(o.$zoom._dragZoomStart){s.removeEventListener("mousemove",o.$zoom._mouseMoveHandler);var n=o.$zoom._dragZoomStart,t=n.target.getBoundingClientRect().left,a=Math.min(n.clientX,e.clientX)-t,i=Math.max(n.clientX,e.clientX)-t,r=n.target.getBoundingClientRect().top,m=Math.min(n.clientY,e.clientY)-r,u=i-a,d=Math.max(n.clientY,e.clientY)-r-m;o.$zoom._dragZoomStart=null,o.$zoom._dragZoomEnd=null;var v=c.zoom&&c.zoom.threshold||0;if(!(u<=v&&d<=v)){var f=o.chartArea,h=o.$zoom._options.zoom,z=f.right-f.left,g=l(h.mode,"x",o)&&u?1+(z-u)/z:1,x=f.bottom-f.top,_=l(h.mode,"y",o);p(o,g,_&&d?1+(x-d)/x:1,{x:(a-f.left)/(1-u/z)+f.left,y:(m-f.top)/(1-d/x)+f.top},void 0,h.drag.animationDuration),"function"==typeof h.onZoomComplete&&h.onZoomComplete({chart:o})}}};var d=null;if(o.$zoom._wheelHandler=function(e){if(e.cancelable&&e.preventDefault(),void 0!==e.deltaY){var n=o.$zoom._options.zoom,t=n.speed,a=n.stickSide,i=e.target.getBoundingClientRect(),r={x:"right"===a?i.right:"left"===a?i.left:e.clientX-i.left,y:e.clientY-i.top};e.deltaY>=0&&(t=-t),p(o,1+t,1+t,r),clearTimeout(d),d=setTimeout((function(){"function"==typeof n.onZoomComplete&&n.onZoomComplete({chart:o})}),250)}},e){var v,h=new e.Manager(s);h.add(new e.Pinch),h.add(new e.Pan({threshold:u}));var z=function(e){var n=1/v*e.scale,t=e.target.getBoundingClientRect(),a={x:e.center.x-t.left,y:e.center.y-t.top},i=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),r=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),m=i/r;p(o,n,n,a,m>.3&&m<1.7?"xy":i>r?"x":"y");var l=o.$zoom._options.zoom;"function"==typeof l.onZoom&&l.onZoom({chart:o}),v=e.scale};h.on("pinchstart",(function(){v=1})),h.on("pinch",z),h.on("pinchend",(function(e){z(e),v=null,t.zoomCumulativeDelta=0;var n=o.$zoom._options.zoom;"function"==typeof n.onZoomComplete&&n.onZoomComplete({chart:o})}));var g=null,x=null,_=!1,y=function(e){if(null!==g&&null!==x){_=!0;var t=e.deltaX-g,a=e.deltaY-x;g=e.deltaX,x=e.deltaY,function(o,e,t){m(o);var a=o.$zoom._options.pan;if(a.enabled){var i="function"==typeof a.mode?a.mode({chart:o}):a.mode;n.each(o.scales,(function(n){n.isHorizontal()&&l(i,"x",o)&&0!==e?(a.scaleAxes="x",f(n,e,a)):!n.isHorizontal()&&l(i,"y",o)&&0!==t&&(a.scaleAxes="y",f(n,t,a))})),o.update("none"),"function"==typeof a.onPan&&a.onPan({chart:o})}}(o,t,a)}};h.on("panstart",(function(o){g=0,x=0,y(o)})),h.on("panmove",y),h.on("panend",(function(){g=null,x=null,t.panCumulativeDelta=0,setTimeout((function(){_=!1}),500);var e=o.$zoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:o})})),o.$zoom._ghostClickHandler=function(o){_&&o.cancelable&&(o.stopImmediatePropagation(),o.preventDefault())},s.addEventListener("click",o.$zoom._ghostClickHandler),o._mc=h}o.resetZoom=function(){m(o);var e=o.$zoom._originalOptions;n.each(o.scales,(function(o){var n=o.options;e[o.id]?(n.min=e[o.id].min,n.max=e[o.id].max):(delete n.min,delete n.max)})),o.update()}},beforeUpdate:function(o,e,n){r(o,n)},beforeDatasetsDraw:function(o){var e=o.ctx;if(o.$zoom._dragZoomEnd){var n=function(o){for(var e=o.scales,n=Object.keys(e),t=0;t<n.length;t++){var a=e[n[t]];if(a.isHorizontal())return a}}(o),t=function(o){for(var e=o.scales,n=Object.keys(e),t=0;t<n.length;t++){var a=e[n[t]];if(!a.isHorizontal())return a}}(o),a=o.$zoom._dragZoomStart,i=o.$zoom._dragZoomEnd,r=n.left,m=n.right,s=t.top,c=t.bottom;if(l(o.$zoom._options.zoom.mode,"x",o)){var u=a.target.getBoundingClientRect().left;r=Math.min(a.clientX,i.clientX)-u,m=Math.max(a.clientX,i.clientX)-u}if(l(o.$zoom._options.zoom.mode,"y",o)){var d=a.target.getBoundingClientRect().top;s=Math.min(a.clientY,i.clientY)-d,c=Math.max(a.clientY,i.clientY)-d}var p=m-r,v=c-s,f=o.$zoom._options.zoom.drag;e.save(),e.beginPath(),e.fillStyle=f.backgroundColor||"rgba(225,225,225,0.3)",e.fillRect(r,s,p,v),f.borderWidth>0&&(e.lineWidth=f.borderWidth,e.strokeStyle=f.borderColor||"rgba(225,225,225)",e.strokeRect(r,s,p,v)),e.restore()}},stop:function(o){if(o.$zoom){var e=o.$zoom,n=e._node;n.removeEventListener("mousedown",e._mouseDownHandler),n.removeEventListener("mousemove",e._mouseMoveHandler),n.ownerDocument.removeEventListener("mouseup",e._mouseUpHandler),n.removeEventListener("wheel",e._wheelHandler),n.removeEventListener("click",e._ghostClickHandler),delete o.$zoom;var t=o._mc;t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy())}}};return o.register(h),h}));
